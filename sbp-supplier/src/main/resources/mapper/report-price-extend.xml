<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wq.sbp.dao.ReportPriceExtendDao">
 	<select id="selectQuoteListBySupId" resultType="Quote">
 		SELECT
 			REPLACE (
				ecb.app_logo,
				#{param2},
				#{param1}
			) AS src,
			ii.car_mark title,
			irpe.ins_id insId,
			(
				SELECT
					COUNT(*)
				FROM
					ibs_report_price irp
				WHERE
					irp.ins_id = ii.id
				AND irp.member_id = #{supplierMemberId}
				AND irp.state = '0'
			) count,
		(SELECT
				iii.`name`
			FROM
				ibs_insurance_info iii
			LEFT JOIN ibs_report_price irp ON iii.id = irp.ins_info_id
			WHERE
				irp.ins_id = ii.id
			AND irp.member_id = #{supplierMemberId}
			AND irp.state = '0' limit 0,1) `name`
		FROM
			ibs_report_price_extend irpe
		LEFT JOIN ibs_insurance ii ON irpe.ins_id = ii.id
		LEFT JOIN es_car_brand ecb ON ii.car_brand_id = ecb.car_brand_id
		WHERE
			irpe.supplier_member_id = #{supplierMemberId}
		AND
			irpe.report_state=0
		ORDER BY
			irpe.id DESC
 	</select>
</mapper>